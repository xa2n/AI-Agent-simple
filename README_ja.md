
# Python ツールとエージェントフレームワーク

このプロジェクトは、エージェントベースのシステム内でツールを作成および使用するためのフレームワークを提供します。ツールを定義するためのデコレータ、ツールを管理および実行するためのエージェントクラス、および通貨換算のサンプルツールが含まれています。

## 特徴

-   **ツールの定義:** `@tool` デコレータを使用して簡単にツールを定義できます。
-   **自動パラメータ処理:** フレームワークは、関数シグネチャとドキュメント文字列からパラメータ情報を自動的に抽出します。
-   **エージェント管理:** `Agent` クラスは、利用可能なツールを管理し、ユーザークエリに基づいてそれらを実行します。
-   **OpenAI 統合:** 計画と実行に OpenAI の GPT モデルを活用します。
-   **通貨換算の例:** 最新の為替レートを使用して通貨を換算するための組み込みツールが含まれています。
-   **構造化された計画:** エージェントは、ユーザークエリを満たすために必要な手順とツール呼び出しの概要を示す、JSON 形式の構造化された計画を生成します。

## インストール

1. リポジトリをクローンします。

    ```bash
    git clone <repository_url>
    ```

2. 必要な依存関係をインストールします。

    ```bash
    pip install -r requirements.txt
    ```
    (`requirements.txt` には `openai` が含まれている必要があります)

3. OpenAI API キーを環境変数として設定します。

    ```bash
    export OPENAI_API_KEY="your_api_key"
    ```

## 使用方法

### ツールの定義

独自のツールを定義するには、`@tool` デコレータを使用します。デコレータは、関数シグネチャとドキュメント文字列からパラメータ情報を自動的に抽出します。

```python
from typing import Literal

@tool()
def convert_currency(amount: float, from_currency: str, to_currency: str) -> str:
    """最新の為替レートを使用して、ある通貨から別の通貨に金額を換算します。

    パラメータ:
        - amount: 換算する金額
        - from_currency: ソース通貨コード (例: USD)
        - to_currency: ターゲット通貨コード (例: EUR)
    """
    # ... (通貨換算の実装)

@tool(name="search_internet")
def search_internet(query: str, region: Literal["US", "JP", "EU"] = "US") -> str:
    """指定されたクエリでインターネットを検索します。

    パラメータ:
        - query: 検索クエリ。
        - region: 検索する地域。
    """
    # ... (インターネット検索の実装)
```

### エージェントの使用

1. `Agent` クラスのインスタンスを作成します。
2. `add_tool()` を使用してエージェントにツールを追加します。
3. `execute()` メソッドを使用してユーザークエリを処理します。

```python
agent = Agent()
agent.add_tool(convert_currency)
# agent.add_tool(search_internet) # 別のツールを追加する例

query = "100 USD を EUR に換算してください"
result = agent.execute(query)
print(result)
```

### クエリの例

エージェントは、ツールを必要とするクエリと、直接回答できるクエリを含む、さまざまなクエリを処理できます。

**ツールを必要とするクエリ:**

```
クエリ: セルビアから日本に旅行します。現地通貨で 1500 ありますが、日本円ではいくらですか？
```

**ツールを必要としないクエリ:**

```
クエリ: お元気ですか？
```

## コード構造

-   **`Tool` クラス:** 名前、説明、関数、およびパラメータを持つツールを表します。
-   **`parse_docstring_params()`:** ドキュメント文字列からパラメータの説明を抽出します。
-   **`get_type_description()`:** 型ヒントの人間が読める説明を取得します。
-   **`tool()` デコレータ:** ツールを定義し、パラメータ情報を自動的に抽出します。
-   **`convert_currency()`:** 通貨換算のサンプルツール。
-   **`Agent` クラス:** ツールを管理し、計画を生成し、ユーザークエリを実行します。
-   **`create_system_prompt()`:** OpenAI モデルのシステムプロンプトを作成します。
-   **`plan()`:** ユーザークエリを実行するための計画を生成します。
-   **`execute()`:** 計画を実行し、結果を返します。
